import{c as z}from"./chunk-TCKTIQDJ.js";import{b as B}from"./chunk-XLKJ7G2V.js";import{E as j,ta as X}from"./chunk-UI2YCGDV.js";import{D as d,F as S,Gb as x,Hb as L,Ja as P,Jb as N,L as E,Oc as C,P as D,Pb as g,Qb as _,Rb as l,Sc as v,_ as p,a as h,b as f,ba as s,fa as y,fb as u,hc as A,ia as O,ic as w,jb as F,jc as k,l as o,la as n,qb as T,t as c,yb as M,z as m,zb as R}from"./chunk-GHECAUUU.js";function V(r,t){r&1&&l(0,"div",2)}var G=new O("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var ae=(()=>{class r{_elementRef=n(P);_ngZone=n(R);_changeDetectorRef=n(C);_renderer=n(F);_cleanupTransitionEnd;constructor(){let e=n(G,{optional:!0});e&&(e.color&&(this.color=this._defaultColor=e.color),this.mode=e.mode||this.mode)}_isNoopAnimation=j();get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;_defaultColor="primary";get value(){return this._value}set value(e){this._value=I(e||0),this._changeDetectorRef.markForCheck()}_value=0;get bufferValue(){return this._bufferValue||0}set bufferValue(e){this._bufferValue=I(e||0),this._changeDetectorRef.markForCheck()}_bufferValue=0;animationEnd=new M;get mode(){return this._mode}set mode(e){this._mode=e,this._changeDetectorRef.markForCheck()}_mode="determinate";ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._cleanupTransitionEnd=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._transitionendHandler)})}ngOnDestroy(){this._cleanupTransitionEnd?.()}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}_transitionendHandler=e=>{this.animationEnd.observers.length===0||!e.target||!e.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))};static \u0275fac=function(a){return new(a||r)};static \u0275cmp=T({type:r,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(a,i){a&2&&(x("aria-valuenow",i._isIndeterminate()?null:i.value)("mode",i.mode),k("mat-"+i.color),w("_mat-animation-noopable",i._isNoopAnimation)("mdc-linear-progress--animation-ready",!i._isNoopAnimation)("mdc-linear-progress--indeterminate",i._isIndeterminate()))},inputs:{color:"color",value:[2,"value","value",v],bufferValue:[2,"bufferValue","bufferValue",v],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(a,i){a&1&&(g(0,"div",0),l(1,"div",1),L(2,V,1,0,"div",2),_(),g(3,"div",3),l(4,"span",4),_(),g(5,"div",5),l(6,"span",4),_()),a&2&&(u(),A("flex-basis",i._getBufferBarFlexBasis()),u(),N(i.mode==="buffer"?2:-1),u(),A("transform",i._getPrimaryBarTransform()))},styles:[`.mat-mdc-progress-bar{display:block;text-align:start}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:max(var(--mat-progress-bar-track-height, 4px),var(--mat-progress-bar-active-indicator-height, 4px))}@media(forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}[dir=rtl] .mdc-linear-progress__bar{right:0;transform-origin:center right}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid;border-color:var(--mat-progress-bar-active-indicator-color, var(--mat-sys-primary));border-top-width:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden;height:var(--mat-progress-bar-track-height, 4px);border-radius:var(--mat-progress-bar-track-shape, var(--mat-sys-corner-none))}.mdc-linear-progress__buffer-dots{-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");background-repeat:repeat-x;flex:auto;transform:rotate(180deg);animation:mdc-linear-progress-buffering 250ms infinite linear;background-color:var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant))}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}[dir=rtl] .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);background-color:var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant))}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mat-progress-bar-track-height, 4px) * -2.5))}}@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(83.67142%)}100%{transform:translateX(200.611057%)}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(84.386165%)}100%{transform:translateX(160.277782%)}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(-83.67142%)}100%{transform:translateX(-200.611057%)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(-37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(-84.386165%)}100%{transform:translateX(-160.277782%)}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}
`],encapsulation:2,changeDetection:0})}return r})();function I(r,t=0,e=100){return Math.max(t,Math.min(e,r))}var b=class{_subject=new o({status:"initialised",step:0,progress:0});_steps;_currentSteps;constructor(t=0){this._steps=t,this._currentSteps=0}destroy(){this._subject.unsubscribe()}getProgress$(){return this._subject.asObservable()}reset(){this._steps=0,this._currentSteps=0,this.nextProgress({status:"initialised",step:0,progress:0})}pending(t){this._steps=t??this._steps,this._currentSteps=0,this.nextProgress({status:"pending",step:this._currentSteps,progress:0})}success(t,e){this._currentSteps<this._steps&&(this._currentSteps++,this.nextProgress({status:"progress",step:this._currentSteps,progress:this.progress(),message:t,result:e}))}error(t,e){this._currentSteps<this._steps&&(this._currentSteps++,this.nextProgress({status:"progress",step:this._currentSteps,progress:this.progress(),error:t,result:e}))}done(){this._currentSteps=this._steps,this.nextProgress({status:"done",step:this._currentSteps,progress:100,message:"Done"})}progress=()=>Math.min(Math.round(this._currentSteps/this._steps*100),100);nextProgress(t){this._subject.closed?console.error("ProgressWatcher has been destroyed and is no longer usable"):this._subject.next(t)}};var U=class r{static APP_ROOT_FOLDER_NAME="Deal Memo App";static TEMPLATES_FOLDER_NAME="Templates";static DEAL_MEMOS_FOLDER_NAME="Deal Memos";static DATA_FOLDER_NAME="Data";static APP_ROOT_FOLDER_PATH=[r.APP_ROOT_FOLDER_NAME];static TEMPLATE_FOLDER_PATH=[...r.APP_ROOT_FOLDER_PATH,r.TEMPLATES_FOLDER_NAME];static DEAL_MEMOS_FOLDER_PATH=[...r.APP_ROOT_FOLDER_PATH,r.DEAL_MEMOS_FOLDER_NAME];static DATA_FOLDER=[...r.APP_ROOT_FOLDER_PATH,r.DATA_FOLDER_NAME];static USER_DATA_NAME="User Data";static APP_DATA_NAME="App Data";appLoadProgressStepper=new b(9);googleDriveService=n(B);googleSheetsService=n(z);googleAuthService=n(X);appFileStructureSubject=new o(null);userDataSpreadsheetSubject=new o(null);appDataSpreadsheetSubject=new o(null);appFileStructure$;constructor(){this.appFileStructure$=this.appFileStructureSubject.asObservable()}loadOrCreateAppData(){this.createAppFileStructure()}createAppFileStructure(){console.log("Creating app file structure");let t={};this.appLoadProgressStepper.pending(),this.googleDriveService.getOrCreateFolder(r.APP_ROOT_FOLDER_NAME).pipe(s(e=>this.appLoadProgressStepper.success()),s(e=>t.rootFolder={id:e,name:r.APP_ROOT_FOLDER_NAME,path:r.APP_ROOT_FOLDER_PATH}),p(e=>m([this.googleDriveService.getOrCreateFolder(r.TEMPLATES_FOLDER_NAME,e).pipe(s(a=>this.appLoadProgressStepper.success())),this.googleDriveService.getOrCreateFolder(r.DEAL_MEMOS_FOLDER_NAME,e).pipe(s(a=>this.appLoadProgressStepper.success())),this.googleDriveService.getOrCreateFolder(r.DATA_FOLDER_NAME,e).pipe(s(a=>this.appLoadProgressStepper.success()))])),s(([e,a,i])=>{t=f(h({},t),{templateFolder:{id:e,name:r.TEMPLATES_FOLDER_NAME,path:r.TEMPLATE_FOLDER_PATH},dealMemosFolder:{id:a,name:r.DEAL_MEMOS_FOLDER_NAME,path:r.DEAL_MEMOS_FOLDER_PATH},dataFolder:{id:i,name:r.DATA_FOLDER_NAME,path:r.DATA_FOLDER}})}),p(e=>m([this.getOrCreateSpreadsheet(r.APP_DATA_NAME,()=>this.createDefaultAppData()).pipe(s(a=>this.appLoadProgressStepper.success()),s(a=>this.appDataSpreadsheetSubject.next(a)),c(a=>a.spreadsheetId??"")),this.getOrCreateSpreadsheet(r.USER_DATA_NAME,()=>this.createDefaultUserData()).pipe(s(a=>this.appLoadProgressStepper.success()),s(a=>this.userDataSpreadsheetSubject.next(a)),c(a=>a.spreadsheetId??""))])),s(([e,a])=>{t=f(h({},t),{appDataFile:{id:e,name:r.APP_DATA_NAME,path:[...r.DATA_FOLDER,r.APP_DATA_NAME]},userDataFile:{id:a,name:r.USER_DATA_NAME,path:[...r.DATA_FOLDER,r.USER_DATA_NAME]}})}),s(e=>this.appFileStructureSubject.next(t)),p(([e,a])=>m([this.googleDriveService.moveFileTo(e,t.dataFolder?.id).pipe(s(i=>this.appLoadProgressStepper.success())),this.googleDriveService.moveFileTo(a,t.dataFolder?.id).pipe(s(i=>this.appLoadProgressStepper.success()))])),S(e=>this.googleAuthService.handleError(e)),D(()=>this.appLoadProgressStepper.done())).subscribe(e=>{})}getOrCreateSpreadsheet(t,e){return this.googleDriveService.findFileByName(t,"application/vnd.google-apps.spreadsheet").pipe(p(a=>a?.length&&a[0].id?this.googleSheetsService.getSpreadsheet(a[0].id):this.googleSheetsService.createSpreadsheet(e())))}createDefaultAppData(){return{title:r.APP_DATA_NAME,sheets:[{title:"Deal Memos",data:[]}]}}createDefaultUserData(){return{title:r.USER_DATA_NAME,sheets:[{title:"Project",data:[["Name","Film Name"]]},{title:"Production Company",data:[["Name","Address","Telephone","Email"]]},{title:"Artist",data:[["Name","Role","Address","Mobile","Email"]]},{title:"Agency",data:[["Name","Address","Telephone","Email"]]},{title:"Agent",data:[["Name","Agency Name"]]}]}}getAppLoadProgress(){return this.appLoadProgressStepper.getProgress$().pipe(c(t=>t.progress))}getAppDataSpreadsheet(){return this.appDataSpreadsheetSubject.asObservable()}getUserDataSpreadsheet(){return this.userDataSpreadsheetSubject.asObservable()}loadUserData(){this.appFileStructure$.pipe(d(t=>!!t),p(t=>this.googleSheetsService.getSpreadsheet(t.userDataFile.id)),d(t=>!!t),E(1)).subscribe(t=>{this.userDataSpreadsheetSubject.next(t)})}getAppFileStructure(){return this.appFileStructureSubject.asObservable().pipe(d(t=>!!t))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=y({token:r,factory:r.\u0275fac,providedIn:"root"})};export{ae as a,b,U as c};
